<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title layout:fragment="title">신고 내역</title>
</head>

<body>
<div layout:fragment="content" class="bg-gray-50">
    <div class="mx-auto max-w-7xl px-6 py-10">

        <!-- 헤더 -->
        <div class="mb-8">
            <h1 class="text-3xl font-extrabold tracking-tight text-gray-900">신고 내역</h1>
            <p class="mt-2 text-sm text-gray-600">접수한 신고의 처리 상태와 결과를 확인할 수 있습니다.</p>
        </div>

        <!-- 상단 요약 + 필터 -->
        <div class="mb-6 rounded-xl border border-gray-200 bg-white p-4 shadow-sm">
            <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                <!-- 총 개수 -->
                <div class="text-sm text-gray-700">
                    <span class="font-medium">총</span>
                    <span class="mx-1 font-semibold text-rose-600"
                          th:text="${reports != null ? #numbers.formatInteger(reports.pageInfo.totalElements, 0, 'COMMA') : 0}">0</span>
                    <span class="font-medium">건</span>
                </div>

                <!-- 검색/필터 -->
                <form method="get" th:action="@{/mypage/reports}" class="flex w-full flex-col gap-2 md:w-auto md:flex-row md:items-center">
                    <!-- q -->
                    <div class="relative w-full md:w-[320px]">
                        <input type="search"
                               name="q"
                               th:value="${q}"
                               placeholder="대상/사유로 검색"
                               class="w-full rounded-lg border border-gray-300 bg-white py-2 pl-10 pr-3 text-sm
                          placeholder:text-gray-400 focus:border-gray-400 focus:outline-none
                          focus:ring-2 focus:ring-gray-100" />
                        <svg class="absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-500"
                             fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>

                    <!-- status -->
                    <select name="status"
                            class="h-10 w-full rounded-lg border border-gray-300 bg-white px-3 text-sm text-gray-800
                         focus:border-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-100 md:w-[180px]">
                        <option value="" th:selected="${status == null or #strings.isEmpty(status)}">전체 상태</option>
                        <option value="RECEIVED" th:selected="${status == 'RECEIVED'}">접수</option>
                        <option value="IN_PROGRESS" th:selected="${status == 'IN_PROGRESS'}">처리중</option>
                        <option value="RESOLVED" th:selected="${status == 'RESOLVED'}">처리완료</option>
                        <option value="REJECTED" th:selected="${status == 'REJECTED'}">반려</option>
                    </select>

                    <div class="flex gap-2">
                        <button type="submit"
                                class="h-10 rounded-lg bg-gray-900 px-4 text-sm font-semibold text-white hover:bg-gray-800">
                            적용
                        </button>

                        <!-- 초기화: q/status 제거 -->
                        <a th:href="@{/mypage/reports}"
                           class="h-10 rounded-lg border border-gray-300 bg-white px-4 text-sm font-semibold text-gray-800 hover:bg-gray-50
                      inline-flex items-center justify-center">
                            초기화
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- 데이터 없을 때 -->
        <div th:if="${reports == null or reports.content == null or reports.content.isEmpty()}"
             class="rounded-xl border border-gray-200 bg-white py-16 text-center shadow-sm">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <h3 class="mt-4 text-lg font-semibold text-gray-900">신고 내역이 없습니다</h3>
            <p class="mt-2 text-sm text-gray-600">신고 접수 후 이 화면에서 처리 상태를 확인할 수 있습니다.</p>
        </div>

        <!-- 리스트: 모바일 카드 -->
        <div th:if="${reports != null and reports.content != null and !reports.content.isEmpty()}"
             class="space-y-3 md:hidden">
            <div th:each="report : ${reports.content}"
                 class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm">
                <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                        <div class="text-sm font-semibold text-gray-900 truncate"
                             th:text="${report.targetLabel}">대상</div>
                        <div class="mt-1 text-xs text-gray-600"
                             th:text="${report.reasonLabel}">사유</div>
                    </div>

                    <!-- 상태 배지 -->
                    <div th:switch="${report.status}"
                         class="shrink-0">
            <span th:case="'RECEIVED'"
                  class="inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700">접수</span>
                        <span th:case="'IN_PROGRESS'"
                              class="inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs font-semibold text-blue-700">처리중</span>
                        <span th:case="'RESOLVED'"
                              class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-1 text-xs font-semibold text-emerald-700">처리완료</span>
                        <span th:case="'REJECTED'"
                              class="inline-flex items-center rounded-full bg-rose-50 px-2 py-1 text-xs font-semibold text-rose-700">반려</span>
                        <span th:case="*"
                              class="inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700">-</span>
                    </div>
                </div>

                <div class="mt-3 flex items-center justify-between text-xs text-gray-600">
                    <div>
                        <span class="font-medium text-gray-700">접수</span>
                        <span class="ml-1" th:text="${report.createdAt}">-</span>
                    </div>
                    <div th:if="${report.resolvedAt != null}">
                        <span class="font-medium text-gray-700">처리</span>
                        <span class="ml-1" th:text="${report.resolvedAt}">-</span>
                    </div>
                </div>

                <div class="mt-3 flex gap-2">
                    <a th:href="@{/mypage/reports/{id}(id=${report.reportId})}"
                       class="inline-flex flex-1 items-center justify-center rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-800 hover:bg-gray-50">
                        상세
                    </a>

                    <a th:if="${report.targetUrl != null}"
                       th:href="${report.targetUrl}"
                       class="inline-flex flex-1 items-center justify-center rounded-lg bg-gray-900 px-3 py-2 text-sm font-semibold text-white hover:bg-gray-800">
                        대상 보기
                    </a>
                </div>
            </div>
        </div>

        <!-- 리스트: 데스크톱 테이블 -->
        <div th:if="${reports != null and reports.content != null and !reports.content.isEmpty()}"
             class="hidden md:block rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">접수일</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">대상</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">사유</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">상태</th>
                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600">처리일</th>
                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600">액션</th>
                </tr>
                </thead>

                <tbody class="divide-y divide-gray-100">
                <tr th:each="report : ${reports.content}" class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm text-gray-700" th:text="${report.createdAt}">-</td>

                    <td class="px-6 py-4 text-sm font-semibold text-gray-900">
                        <span th:text="${report.targetLabel}">대상</span>
                    </td>

                    <td class="px-6 py-4 text-sm text-gray-700">
                        <span th:text="${report.reasonLabel}">사유</span>
                    </td>

                    <td class="px-6 py-4">
            <span th:switch="${report.status}">
              <span th:case="'RECEIVED'"
                    class="inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700">접수</span>
              <span th:case="'IN_PROGRESS'"
                    class="inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs font-semibold text-blue-700">처리중</span>
              <span th:case="'RESOLVED'"
                    class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-1 text-xs font-semibold text-emerald-700">처리완료</span>
              <span th:case="'REJECTED'"
                    class="inline-flex items-center rounded-full bg-rose-50 px-2 py-1 text-xs font-semibold text-rose-700">반려</span>
              <span th:case="*"
                    class="inline-flex items-center rounded-full bg-gray-100 px-2 py-1 text-xs font-semibold text-gray-700">-</span>
            </span>
                    </td>

                    <td class="px-6 py-4 text-sm text-gray-700"
                        th:text="${report.resolvedAt != null ? report.resolvedAt : '-'}">-</td>

                    <td class="px-6 py-4 text-right">
                        <div class="inline-flex gap-2">
                            <a th:href="@{/mypage/reports/{id}(id=${report.reportId})}"
                               class="inline-flex items-center justify-center rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-800 hover:bg-gray-50">
                                상세
                            </a>

                            <a th:if="${report.targetUrl != null}"
                               th:href="${report.targetUrl}"
                               class="inline-flex items-center justify-center rounded-lg bg-gray-900 px-3 py-2 text-sm font-semibold text-white hover:bg-gray-800">
                                대상 보기
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 페이지네이션 -->
        <div th:if="${reports != null and reports.pageInfo != null and reports.pageInfo.totalPages > 1}"
             class="mt-10">
            <nav class="flex items-center justify-center gap-2" aria-label="Pagination">

                <!-- 이전 -->
                <a th:if="${reports.pageInfo.hasPrevious}"
                   th:href="@{/mypage/reports(page=${reports.pageInfo.currentPage - 1}, q=${q}, status=${status})}"
                   class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 bg-white text-sm font-semibold text-gray-700 hover:bg-gray-50">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>

                <!-- 페이지 번호 -->
                <div class="flex gap-1">
                    <a th:each="i : ${#numbers.sequence(0, reports.pageInfo.totalPages - 1)}"
                       th:href="@{/mypage/reports(page=${i}, q=${q}, status=${status})}"
                       th:classappend="${i == reports.pageInfo.currentPage} ? 'bg-gray-900 text-white border-gray-900' : 'bg-white text-gray-700 hover:bg-gray-50'"
                       class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 text-sm font-semibold">
                        <span th:text="${i + 1}">1</span>
                    </a>
                </div>

                <!-- 다음 -->
                <a th:if="${reports.pageInfo.hasNext}"
                   th:href="@{/mypage/reports(page=${reports.pageInfo.currentPage + 1}, q=${q}, status=${status})}"
                   class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-gray-300 bg-white text-sm font-semibold text-gray-700 hover:bg-gray-50">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </nav>
        </div>

    </div>
</div>
</body>
</html>
